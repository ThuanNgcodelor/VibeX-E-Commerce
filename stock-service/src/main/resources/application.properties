spring.application.name=stock-service
server.port=8004

# ============================================
# REDIS CONFIGURATION
# ============================================
spring.data.redis.host=localhost
spring.data.redis.port=6379

# ============================================
# KAFKA CONFIGURATION (Product Price Sync)
# ============================================
# Kafka Producer
spring.kafka.producer.bootstrap-servers=localhost:9092
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer

# Kafka Consumer
spring.kafka.consumer.bootstrap-servers=localhost:9092
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.properties.spring.json.trusted.packages=*
spring.kafka.consumer.properties.spring.json.value.default.type=com.example.stockservice.event.ProductUpdateKafkaEvent
spring.kafka.consumer.properties.spring.json.use.type.headers=false
spring.kafka.consumer.group-id=stock-service-group

# Kafka Topic
kafka.topic.product-updates=product-updates

# Bootstrap servers (chung)
spring.kafka.bootstrap-servers=localhost:9092

# ============================================
# SWAGGER & CONFIG SERVER
# ============================================
springdoc.swagger-ui.path=/swagger-ui.html
spring.config.import=optional:configserver:http://localhost:8888/

# ============================================
# Database Connection Pool (HikariCP)
# ============================================
# Maximum s? connections trong pool - Stock Service c?n nhi?u connections vì x? lý Inventory
# Giá tr? 30 phù h?p v?i service có traffic cao, nhi?u thao tác c?p nh?t kho ??ng th?i
spring.datasource.hikari.maximum-pool-size=30

# Minimum s? idle connections luôn gi? s?n trong pool
# Gi? 10 connections s?n ?? tránh delay khi có request m?i (quan tr?ng v?i stock operations)
spring.datasource.hikari.minimum-idle=10

# Timeout khi ch? connection t? pool (milliseconds)
# N?u không có connection available trong 30 giây -> throw exception
spring.datasource.hikari.connection-timeout=30000

# Timeout cho idle connections (milliseconds = 10 phút)
# T? ??ng ?óng connections không ???c s? d?ng sau 10 phút ?? gi?i phóng tài nguyên
spring.datasource.hikari.idle-timeout=600000

# Maximum lifetime c?a connection (milliseconds = 30 phút)
# ?óng connection sau 30 phút dù ?ang ???c s? d?ng ?? tránh stale connections
spring.datasource.hikari.max-lifetime=1800000

# Phát hi?n connection leak (milliseconds = 1 phút)
# C?nh báo n?u connection không ???c ?óng sau 1 phút (có th? do code quên close)
spring.datasource.hikari.leak-detection-threshold=60000

# Connection test query - Ki?m tra connection còn s?ng tr??c khi s? d?ng
# SELECT 1 là query ??n gi?n nh?t, nhanh nh?t ?? test connection
spring.datasource.hikari.connection-test-query=SELECT 1

# Pool name - Tên pool ?? d? debug và monitor trong logs
spring.datasource.hikari.pool-name=StockServiceHikariPool

# ============================================
# Tomcat Thread Pool (High Traffic Service)
# ============================================
# Maximum s? threads x? lý HTTP requests ??ng th?i
# 500 threads cho phép x? lý 500 requests cùng lúc (phù h?p v?i stock service có traffic cao)
server.tomcat.threads.max=500

# Minimum s? threads gi? s?n (luôn có s?n, không c?n t?o m?i)
# Gi? 50 threads s?n ?? x? lý requests ngay l?p t?c, tránh delay
server.tomcat.threads.min-spare=50

# Maximum s? connections ch? trong queue (khi t?t c? threads ?ang busy)
# Khi 500 threads ??u ?ang x? lý, 1000 connections ti?p theo s? ch? trong queue
server.tomcat.accept-count=1000

# Maximum s? connections TCP (t?ng s? connections server có th? nh?n)
# 10000 connections cho phép server ch?u t?i cao, phù h?p v?i microservice có nhi?u clients
server.tomcat.max-connections=10000

# Connection timeout (milliseconds = 20 giây)
# ?óng connection n?u không có request trong 20 giây ?? gi?i phóng tài nguyên
server.tomcat.connection-timeout=20000

# Enable compression - Nén response ?? gi?m bandwidth
# Gi?m kích th??c response (JSON, HTML, CSS, JS) -> t?ng t?c ?? load
server.compression.enabled=true

# Các MIME types s? ???c nén
# Nén text/html, JSON, CSS, JS ?? gi?m kích th??c response
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json

# Minimum response size ?? nén (bytes)
# Ch? nén response >= 1KB (1024 bytes), vì nén response nh? không hi?u qu?
server.compression.min-response-size=1024

# ============================================
#  Spring Boot Actuator (Monitoring)
# ============================================
# Expose các endpoints c?a Actuator ?? monitor service
# health: Ki?m tra service còn s?ng không
# metrics: Xem các metrics (CPU, memory, requests, etc.)
# info: Thông tin v? service
# prometheus: Export metrics theo format Prometheus (?? tích h?p v?i Grafana)
management.endpoints.web.exposure.include=health,metrics,info,prometheus

# Hi?n th? chi ti?t health check (database, disk, etc.)
# Always: Luôn hi?n th? chi ti?t (có th? dùng "when-authorized" ?? b?o m?t h?n)
management.endpoint.health.show-details=always

# Tag application name cho metrics
# Giúp phân bi?t metrics c?a các services khác nhau trong Prometheus/Grafana
management.metrics.tags.application=${spring.application.name}