spring.application.name=payment-service
server.port=8006

# ============================================
# VNPAY CONFIGURATION
# ============================================
vnpay.tmn-code=OCFVVWW0
vnpay.hash-secret=4QW5KB2ZPGEME35K90BTZP2QFM7UWNRT
vnpay.pay-url=https://sandbox.vnpayment.vn/paymentv2/vpcpay.html
vnpay.api-url=https://sandbox.vnpayment.vn/merchant_webapi/api/transaction
vnpay.return-url=http://localhost:5173/payment/vnpay/return

# MOMO CONFIGURATION
momo.partner-code=MOMO
momo.access-key=F8BBA842ECF85
momo.secret-key=K951B6PE1waDMi640xX08PD3vg6EkVlz
momo.api-url=https://test-payment.momo.vn/v2/gateway/api/create
momo.return-url=http://localhost:5173/payment/momo/return
momo.ipn-url=http://localhost:8080/payment/v1/payment/momo/ipn
#spring.config.import=configserver:http://localhost:8888/


spring.config.import=optional:configserver:http://localhost:8888/

# ============================================
# DISCOVERY & CONFIG SERVER
# ============================================

#spring.config.import=configserver:http://localhost:8888/
#spring.config.import=optional:configserver:http://localhost:8888/
eureka.client.service-url.defaultZone=http://localhost:8761/eureka
eureka.instance.prefer-ip-address=true

# ============================================
# KAFKA CONFIGURATION
# ============================================
spring.kafka.producer.bootstrap-servers=localhost:9092
spring.kafka.consumer.bootstrap-servers=localhost:9092

## Producer configuration
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer

## Consumer configuration (B? sung ?? tránh l?i khi Payment nh?n event)
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.properties.spring.json.trusted.packages=*

# Kafka Topic Names
kafka.topic.payment=payment-topic
# Consumer Group ID
spring.kafka.consumer.group-id=payment-service-group

# ============================================
# Database Connection Pool (HikariCP)
# ============================================
# S? l??ng k?t n?i t?i ?a trong pool
# Giá tr? 25 phù h?p v?i service x? lý thanh toán (g?i API bên ngoài, thao tác DB)
spring.datasource.hikari.maximum-pool-size=25

# S? l??ng k?t n?i t?i thi?u luôn gi? s?n
# Gi? 5 connections s?n ?? tránh delay khi có request m?i
spring.datasource.hikari.minimum-idle=5

# Th?i gian ch? k?t n?i t? pool (30 giây)
# N?u không có connection available trong 30 giây -> throw exception
spring.datasource.hikari.connection-timeout=30000

# Th?i gian ch? cho k?t n?i r?nh (10 phút)
# T? ??ng ?óng connections không ???c s? d?ng sau 10 phút
spring.datasource.hikari.idle-timeout=600000

# Tu?i th? t?i ?a c?a connection (30 phút)
# ?óng connection sau 30 phút dù ?ang ???c s? d?ng ?? tránh l?i "treo" k?t n?i
spring.datasource.hikari.max-lifetime=1800000

# Ng??ng phát hi?n rò r? k?t n?i (1 phút)
# C?nh báo n?u connection không ???c ?óng sau 1 phút
spring.datasource.hikari.leak-detection-threshold=60000

# Câu l?nh ki?m tra k?t n?i còn s?ng
spring.datasource.hikari.connection-test-query=SELECT 1

# Tên pool ?? d? debug trong logs
spring.datasource.hikari.pool-name=PaymentServiceHikariPool

# ============================================
# Tomcat Thread Pool (Medium Traffic)
# ============================================
# S? l??ng threads t?i ?a x? lý HTTP requests
# 200 threads phù h?p v?i payment service có traffic trung bình
server.tomcat.threads.max=200

# S? l??ng threads gi? s?n
# Gi? 20 threads s?n ?? x? lý requests ngay l?p t?c
server.tomcat.threads.min-spare=20

# S? l??ng connections ch? trong hàng ??i (Queue)
# Khi 200 threads ??u b?n, 500 connections ti?p theo s? ch? trong queue
server.tomcat.accept-count=500

# T?ng s? connections TCP t?i ?a server có th? nh?n
server.tomcat.max-connections=5000

# Th?i gian ch? c?a connection (20 giây)
server.tomcat.connection-timeout=20000

# Enable compression - Nén response ?? gi?m b?ng thông
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# ============================================
# Async Processing
# ============================================
# Enable async support - X? lý requests không ??ng b?
spring.web.async.request-timeout=30000
spring.web.async.timeout=30000

# Thread pool cho async tasks (riêng bi?t v?i Tomcat threads)
spring.task.execution.pool.core-size=20
spring.task.execution.pool.max-size=50
spring.task.execution.pool.queue-capacity=500
spring.task.execution.thread-name-prefix=async-task-

# ============================================
# JPA Batch Processing
# ============================================
# Batch size ?? t?i ?u inserts/updates vào Database
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# T?t log SQL trong production ?? gi?m t?i
spring.jpa.show-sql=false

# Ki?m tra connection tr??c khi dùng (Validation)
spring.datasource.hikari.validation-timeout=3000

# ============================================
# Spring Boot Actuator (Monitoring)
# ============================================
# Expose các endpoints c?a Actuator
management.endpoints.web.exposure.include=health,metrics,info,prometheus

# Hi?n th? chi ti?t health check
management.endpoint.health.show-details=always

# Tag tên ?ng d?ng cho metrics
management.metrics.tags.application=${spring.application.name}