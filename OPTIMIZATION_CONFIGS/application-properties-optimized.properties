# ✅ TỐI ƯU: Application Properties Template
# Copy các config này vào application.properties của từng service

# ============================================
# DATABASE CONNECTION POOL (HikariCP)
# ============================================
# Maximum số connections trong pool
spring.datasource.hikari.maximum-pool-size=20

# Minimum số idle connections (luôn giữ sẵn)
spring.datasource.hikari.minimum-idle=5

# Timeout khi chờ connection từ pool (ms)
spring.datasource.hikari.connection-timeout=30000

# Timeout cho idle connections (ms) - tự động đóng connections không dùng
spring.datasource.hikari.idle-timeout=600000

# Maximum lifetime của connection (ms) - đóng connection sau thời gian này
spring.datasource.hikari.max-lifetime=1800000

# Phát hiện connection leak (ms) - cảnh báo nếu connection không được đóng
spring.datasource.hikari.leak-detection-threshold=60000

# Connection test query (đảm bảo connection còn sống)
spring.datasource.hikari.connection-test-query=SELECT 1

# Pool name (để dễ debug)
spring.datasource.hikari.pool-name=ShopeeHikariPool

# ============================================
# TOMCAT THREAD POOL
# ============================================
# Maximum số threads xử lý requests
server.tomcat.threads.max=500

# Minimum số threads giữ sẵn (luôn có sẵn)
server.tomcat.threads.min-spare=50

# Maximum số connections chờ trong queue (khi tất cả threads đang busy)
server.tomcat.accept-count=1000

# Maximum số connections TCP (tổng số connections)
server.tomcat.max-connections=10000

# Connection timeout (ms) - đóng connection nếu không có request trong 20s
server.connection-timeout=20000

# Enable compression
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# ============================================
# SPRING BOOT ACTUATOR (Monitoring)
# ============================================
# Enable Actuator Endpoints
management.endpoints.web.exposure.include=health,metrics,info,prometheus
management.endpoint.health.show-details=always

# Metrics Export
management.metrics.export.prometheus.enabled=true
management.metrics.tags.application=${spring.application.name}

# ============================================
# KAFKA CONSUMER (nếu service có consumer)
# ============================================
# Tối ưu fetch và poll settings
spring.kafka.consumer.fetch-min-size=1024
spring.kafka.consumer.fetch-max-wait=500
spring.kafka.consumer.max-poll-records=500

# ============================================
# WEBSOCKET (nếu service có WebSocket)
# ============================================
# Maximum số WebSocket connections
spring.websocket.max-connections=10000

# Heartbeat interval (giữ connection alive)
spring.websocket.heartbeat.interval=30000

# Connection timeout
spring.websocket.timeout=3600000

# ============================================
# JPA/HIBERNATE (nếu cần)
# ============================================
# Batch size để tối ưu inserts/updates
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# Query cache (nếu dùng)
# spring.jpa.properties.hibernate.cache.use_query_cache=true
# spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.jcache.JCacheRegionFactory

# ============================================
# LOGGING (tùy chọn)
# ============================================
# Log slow queries
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

