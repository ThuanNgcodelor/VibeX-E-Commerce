server.port=6003
spring.application.name=user-service
application-title=User Service
springdoc.swagger-ui.path=/swagger-ui.html

spring.config.import=optional:configserver:${SPRING_CLOUD_CONFIG_URI:http://localhost:8888/}

# ============================================
# Database Connection Pool (HikariCP)
# ============================================
# Số lượng kết nối tối đa (Max connections) trong bể chứa (pool)
# 25 là con số phù hợp cho User Service (nơi chủ yếu xử lý login, xem profile...)
spring.datasource.hikari.maximum-pool-size=25

# Số lượng kết nối tối thiểu luôn được giữ ở trạng thái rỗng (idle)
# Giữ sẵn 5 kết nối để khi có request mới là dùng được ngay, không cần khởi tạo lại
spring.datasource.hikari.minimum-idle=5

# Thời gian tối đa chờ để lấy được một kết nối từ pool (30 giây)
# Nếu sau 30s mà không lấy được kết nối nào (do pool bị full), sẽ báo lỗi Exception
spring.datasource.hikari.connection-timeout=30000

# Thời gian tối đa một kết nối được phép nằm rỗng (10 phút)
# Nếu quá 10 phút không ai dùng, kết nối này sẽ bị đóng để tiết kiệm tài nguyên
spring.datasource.hikari.idle-timeout=600000

# Tuổi thọ tối đa của một kết nối (30 phút)
# Dù đang dùng hay không, sau 30 phút kết nối sẽ bị thay mới để tránh lỗi tiềm ẩn từ phía DB
spring.datasource.hikari.max-lifetime=1800000

# Ngưỡng thời gian để phát hiện rò rỉ kết nối (Leak Detection - 60 giây)
# Nếu code mượn kết nối quá 1 phút mà chưa trả, hệ thống sẽ log cảnh báo (dấu hiệu code lỗi)
spring.datasource.hikari.leak-detection-threshold=60000

# Câu lệnh SQL đơn giản để kiểm tra kết nối còn sống hay không
# SELECT 1 là câu lệnh nhỏ nhất, nhanh nhất để ping Database
spring.datasource.hikari.connection-test-query=SELECT 1

# Đặt tên cho Pool để dễ dàng nhận biết khi xem log hoặc debug
spring.datasource.hikari.pool-name=UserServiceHikariPool

# ============================================
# Tomcat Thread Pool (Web Server)
# ============================================
# Số lượng luồng (Thread) tối đa để xử lý HTTP requests đồng thời
# 300 threads giúp service chịu được tải trung bình khá (Medium Traffic)
server.tomcat.threads.max=300

# Số lượng luồng tối thiểu luôn được nuôi sẵn
# Giữ 30 luồng chờ để phản hồi ngay lập tức khi có khách vào
server.tomcat.threads.min-spare=30

# Độ dài hàng đợi (Queue) khi tất cả các luồng đều bận
# Nếu 300 threads đều đang làm việc, 500 request tiếp theo sẽ được xếp hàng chờ
server.tomcat.accept-count=500

# Tổng số lượng kết nối TCP tối đa mà Server chấp nhận
# 5000 connections (bao gồm cả connections đang xử lý và đang chờ keep-alive)
server.tomcat.max-connections=5000

# Thời gian chờ của một kết nối (20 giây)
# Nếu client kết nối mà không gửi request trong 20s, server sẽ ngắt kết nối
server.tomcat.connection-timeout=20000

# Bật tính năng nén dữ liệu phản hồi (Response Compression)
# Giúp giảm dung lượng file gửi đi, tăng tốc độ tải cho người dùng
server.compression.enabled=true

# Định nghĩa các loại file (MIME types) sẽ được nén
# Nén HTML, XML, Text, CSS, JS, JSON
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json

# Kích thước tối thiểu để thực hiện nén (1KB)
# Chỉ nén nếu dữ liệu lớn hơn 1024 bytes (nhỏ quá nén sẽ tốn CPU mà không hiệu quả)
server.compression.min-response-size=1024

# ============================================
# Spring Boot Actuator (Monitoring)
# ============================================
# Mở các cổng (endpoints) giám sát cần thiết
# health (sức khỏe), metrics (số liệu), info (thông tin), prometheus (để vẽ biểu đồ)
management.endpoints.web.exposure.include=health,metrics,info,prometheus

# Hiển thị chi tiết trạng thái sức khỏe
# "always" sẽ hiện rõ: Database UP/DOWN, Disk Space còn bao nhiêu...
management.endpoint.health.show-details=always

# Gắn nhãn tên ứng dụng vào dữ liệu metrics
# Giúp phân biệt metrics của "User Service" với các service khác trên Grafana
management.metrics.tags.application=${spring.application.name}

# ============================================
# File Upload Limits
# ============================================
spring.servlet.multipart.max-file-size=100MB
spring.servlet.multipart.max-request-size=100MB